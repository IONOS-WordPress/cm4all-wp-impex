<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../about.html"><strong aria-hidden="true">1.</strong> About</a></li><li class="chapter-item expanded "><a href="../explanation-of-terms.html"><strong aria-hidden="true">2.</strong> Explanation of terms</a></li><li class="chapter-item expanded "><a href="../features.html"><strong aria-hidden="true">3.</strong> Features</a></li><li class="chapter-item expanded "><a href="../impex-cli.html"><strong aria-hidden="true">4.</strong> CLI</a></li><li class="chapter-item expanded "><a href="../migrating-content.html"><strong aria-hidden="true">5.</strong> Migrating content</a></li><li class="chapter-item expanded "><a href="../cm4all-wp-impex-generator/index.html"><strong aria-hidden="true">6.</strong> Package @cm4all-wp-impex/generator</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cm4all-wp-impex-generator/static-website-tutorial.html"><strong aria-hidden="true">6.1.</strong> Static website conversion tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="../api/index.html"><strong aria-hidden="true">7.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/configuration.html" class="active"><strong aria-hidden="true">7.1.</strong> Configuration</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li><a href="#usage">Usage</a>
<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#custom-profile-configuration">Custom profile configuration</a>
<ul>
<li><a href="#export">Export</a></li>
<li><a href="#import">Import</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>ImpEx supports <strong>out of the box</strong> the export/import of</p>
<ul>
<li>
<p>content (posts/pages/nav_menu and media assets)</p>
</li>
<li>
<p>FSE content (Full Site Editing assets like block patterns, templates, template parts, reusable blocks and theme settings)</p>
</li>
</ul>
<p>For everything else (third-party plugin settings for example) you can provide custom export/import profile(s).</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>ImpEx can be customized by providing <strong>Profiles</strong>.</p>
<p>An <strong>Export profile</strong> defines the WordPress data to export.</p>
<p>An <strong>Import profile</strong> declares how and which export data could be imported.</p>
<h2 id="custom-profile-configuration"><a class="header" href="#custom-profile-configuration">Custom profile configuration</a></h2>
<p><strong>Profiles</strong> are configured and registered using a custom ImpEx <a href="https://developer.wordpress.org/plugins/hooks/actions/">WordPress action</a> :</p>
<pre><code class="language-php">\add_action('cm4all_wp_impex_register_profiles', function () {
  // your ImpEx profile registration goes here
  ...
});
</code></pre>
<p>Using a <a href="https://developer.wordpress.org/plugins/hooks/actions/">WordPress action</a> for ImpEx profile registration guarantees that the action callback is only executed if the ImpEx plugin is activated.</p>
<blockquote>
<p>Implementing a ImpEx profile in your WordPress code does not make ImpEx a required dependency for your plugin since the code is only executed if ImpEx is installed and active.</p>
</blockquote>
<h3 id="export"><a class="header" href="#export">Export</a></h3>
<p>Let's say you want to export the core WordPress contents (pages/posts/attachments and stuff) but also</p>
<ul>
<li>
<p><a href="https://wordpress.org/plugins/ninja-forms/">Ninja Forms Contact Form</a> contents and settings</p>
</li>
<li>
<p><a href="https://wordpress.org/plugins/ultimate-maps-by-supsystic/">Ultimate Maps by Supsystic</a> contents and settings</p>
</li>
<li>
<p><a href="https://wordpress.org/plugins/complianz-gdpr/">Complianz GDPR</a> contents and settings</p>
</li>
<li>
<p>and a few options of your own plugin</p>
</li>
</ul>
<p>To do so you need to create a <strong>Export profile</strong>.</p>
<p>Fortunately ImpEx already provides some low level building blocks called <strong>ExportProvider</strong> to make our ImpEx Profile declaration piece of cake :</p>
<pre><code class="language-php">\add_action('cm4all_wp_impex_register_profiles', function () {
  // ensure admin plugin functions are available
  require_once(ABSPATH . 'wp-admin/includes/plugin.php');

  // register a new export profile with a unique name
  $profile = Impex::getInstance()-&gt;Export-&gt;addProfile('impex-export-profile-example');
  // give the profile a senseful description
  $profile-&gt;setDescription('Exports posts/pages/media-assets and plugin data of complianz-gdpr,ninja-forms and ultimate-maps-by-supsystic');

  // export pages/posts/comments/block patterns/templates/template parts/reusable blocks
  $profile-&gt;addTask(
    'wordpress content',
    cm4all\wp\impex\ContentExporter::PROVIDER_NAME
  );

  // export media
  $profile-&gt;addTask(
    'wordpress attachments (uploads)',
    cm4all\wp\impex\AttachmentsExporter::PROVIDER_NAME
  );

  // export ninja-forms related tables/options if active
  $plugin_ninjaforms_disabled = !is_plugin_active(&quot;ninja-forms/ninja-forms.php&quot;);
  $profile-&gt;addTask(
    &quot;ninja-forms db tables (nf3_*)&quot;,
    cm4all\wp\impex\DbTablesExporter::PROVIDER_NAME,
    // ninja-forms stores data in custom tables prefixed with 'nf_3'
    [cm4all\wp\impex\DbTablesExporter::OPTION_SELECTOR =&gt; 'nf3_*']
  )-&gt;disabled = $plugin_ninjaforms_disabled;
  $profile-&gt;addTask(
    'ninja-forms wp_options',
    cm4all\wp\impex\WpOptionsExporter::PROVIDER_NAME,
    // ninja-forms stores it options prefixed with 'ninja_*', 'nf_*', 'wp_nf_*', 'widget_ninja_*'
    [
      cm4all\wp\impex\WpOptionsExporter::OPTION_SELECTOR =&gt; ['ninja_*', 'nf_*', 'wp_nf_*', 'widget_ninja_*']
    ]
  )-&gt;disabled = $plugin_ninjaforms_disabled;

  // export ultimate_maps related tables/options
  $plugin_ultimatemaps_disabled = !is_plugin_active(&quot;ultimate-maps-by-supsystic/ums.php&quot;);
  $profile-&gt;addTask(
    &quot;ultimate_maps db tables (ums_*)&quot;,
    cm4all\wp\impex\DbTablesExporter::PROVIDER_NAME,
    // ultimate maps stores data in custom tables prefixed with 'ums_'
    [cm4all\wp\impex\DbTablesExporter::OPTION_SELECTOR =&gt; 'ums_*']
  )-&gt;disabled = $plugin_ultimatemaps_disabled;
  $profile-&gt;addTask(
    'ultimate_maps wp_options',
    cm4all\wp\impex\WpOptionsExporter::PROVIDER_NAME,
    // ultimate maps stores data in wp options prefixed with 'ums_*', 'wp_ums_*'
    [
      cm4all\wp\impex\WpOptionsExporter::OPTION_SELECTOR =&gt; ['ums_*', 'wp_ums_*']
    ]
  )-&gt;disabled = $plugin_ultimatemaps_disabled;

  // export complianz related tables/options
  $plugin_complianz_disabled = !is_plugin_active(&quot;complianz-gdpr/complianz-gpdr.php&quot;);
  $profile-&gt;addTask(
    &quot;complianz-gdpr db tables&quot;,
    cm4all\wp\impex\DbTablesExporter::PROVIDER_NAME,
    // complianz stores data in custom tables prefixed with 'cmplz_*'
    [DbTablesExporter::OPTION_SELECTOR =&gt; 'cmplz_*',]
  )-&gt;disabled = $plugin_complianz_disabled;
  $profile-&gt;addTask(
    'complianz-gdpr wp_options',
    cm4all\wp\impex\WpOptionsExporter::PROVIDER_NAME,
    // complianz stores data in wp options prefixed with 'cmplz_*', 'complianz_*'
    [
      cm4all\wp\impex\WpOptionsExporter::OPTION_SELECTOR =&gt; ['cmplz_*', 'complianz_*']
    ]
  )-&gt;disabled = $plugin_complianz_disabled;
});
</code></pre>
<blockquote>
<p>Caveat: Do not provide the WordPress database table prefix (default is <code>wp_</code>) to the <code>cm4all\wp\impex\WpOptionsExporter::OPTION_SELECTOR</code> option since it may vary on installations. the <code>cm4all\wp\impex\WpOptionsExporter</code> will take care of that.</p>
</blockquote>
<p>That's it !</p>
<p>Now you can trigger the export using this ImpEx export configuration in the ImpEx screen at WP dashboard (or even using the <a href="./impex-cli.html">ImpEx CLI</a>)</p>
<h3 id="import"><a class="header" href="#import">Import</a></h3>
<p>Thanks to ImpEx architecture you normally don't need to define a custom import configuration.</p>
<p>ImpEx sports a generic <code>all</code> import provider and profile importing <strong>anything</strong> exported using the ImpEx building blocks.</p>
<blockquote>
<p>As long as you use the <strong>Exporter</strong> provided by ImpEx in your custom Export profile, you don't need to define an matching custom import profile.</p>
</blockquote>
<p>In rare cases you need to execute PHP code after the import to get everything working.</p>
<p>In our export profile example above we implemented support for <a href="https://wordpress.org/plugins/ninja-forms/">Ninja Forms Contact Form</a>. Unfortunately the forms will be in maintenance mode after importing them.</p>
<p>To fix this we need to execute some PHP code (<code>WPN_Helper::set_forms_maintenance_mode(0)</code> from the <a href="https://wordpress.org/plugins/ninja-forms/">Ninja Forms Contact Form Plugin</a>) after the import.</p>
<p>ImpEx provides <strong>Events</strong> for exactly that purpose :</p>
<pre><code class="language-php">\add_action('cm4all_wp_impex_register_profiles', function () {
  // ensure admin plugin functions are available
  require_once(ABSPATH . 'wp-admin/includes/plugin.php');

  // get the 'all' profile
  $profile = Impex::getInstance()-&gt;Import-&gt;getProfile('all');

  // attach a listener callback for the `EVENT_IMPORT_END` event
  $profile-&gt;events(ImpexImport::EVENT_IMPORT_END)-&gt;addListener(
    'reset ninja forms mainentance mode',
    fn () =&gt; method_exists('WPN_Helper', 'set_forms_maintenance_mode') &amp;&amp; WPN_Helper::set_forms_maintenance_mode(0)
  );
});
</code></pre>
<p>Tada - that's it !</p>
<p>There ist just one caveat ... what if the ImpEx 'all' profile gets disabled by someone else ?
To work around this we can also introduce a custom import profile utilizing the 'all' import provider:</p>
<pre><code class="language-php">\add_action('cm4all_wp_impex_register_profiles', function () {
  // ensure admin plugin functions are available
  require_once(ABSPATH . 'wp-admin/includes/plugin.php');

  // create a new import profile
  $profile = Impex::getInstance()-&gt;Import-&gt;addProfile('impex-import-profile-example');
  $profile-&gt;setDescription('Import everything example with event listener');

  // reuse the 'all' import provider registered by the 'all' import profile
  $profile-&gt;addTask('main', Impex::getInstance()-&gt;Import-&gt;getProvider('all')-&gt;name);

  // attach a listener callback for the `EVENT_IMPORT_END` event
  $profile-&gt;events(ImpexImport::EVENT_IMPORT_END)-&gt;addListener(
    'reset ninja forms mainentance mode',
    fn () =&gt; method_exists('WPN_Helper', 'set_forms_maintenance_mode') &amp;&amp; WPN_Helper::set_forms_maintenance_mode(0)
  );
});
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../api/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../api/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
